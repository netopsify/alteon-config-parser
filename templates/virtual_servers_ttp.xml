<template results="per_template">
	<group name="virt.{{ vip }}**" default="">
/c/slb/virt {{ virt_seq }}
	{{ config_state }}
	ipver {{ ipver }}
	vip {{ vip | is_ip }}
	rtsrcmac {{ rtsrcmac }}
	vname {{ vip_name | re(".*") }}
		<group name="services.{{ vip_port }}" default="" containsall="vip_port, vip_service">
/c/slb/virt {{ virt_seq }}/service {{ vip_port }} {{ vip_service | exclude_re('^wts$')| exclude_re('^wts/wts$') }}
	group {{ group_seq }}
	rport {{ real_port }}
	dbind {{ dbind | replace('forceproxy', 'snat') }}
	pbind {{ pbind | re(".*") | contains_re('clientip') | let("clientip") }}
	ptmout {{ ptmout }}
			<group name="wts" containsall="wts, wts_state">
/c/slb/virt {{ virt_seq }}/service {{ vip_port }} {{ vip_service | contains_re('wts') }}
	group {{ group_seq }}
	rport {{ real_port }}
	dbind {{ dbind | replace('forceproxy', 'snat') }}
	ptmout {{ ptmout }}
/c/slb/virt {{ virt_seq }}/service {{ vip_port }} {{ wts | contains_re('wts/wts')}}
	{{ wts_state }}
	userhash {{ userhash }}
			</group>
			<group name="appshape" containsall="appshape, appshape_seq, appshape_script">
/c/slb/virt {{ virt_seq }}/service {{ vip_port }} {{ vip_service }}/{{ appshape | contains_re('appshape')}}
	add {{ appshape_seq }} {{ appshape_script }}
	alwayson {{ alwayson }}
			</group>
			<group name="xforward" containsall="http, xforward">
/c/slb/virt {{ virt_seq }}/service {{ vip_port }} {{ vip_service }}/{{ http | contains_re('http')}}
	xforward {{ xforward }}
			</group>
			<group name="ssl_profile**" containsall="ssl, ssl_server_cert, ssl_profile">
/c/slb/virt {{ virt_seq }}/service {{ vip_port }} {{ ssl | contains_re('https/ssl')}}
	srvrcert cert {{ ssl_server_cert }}
	sslpol {{ ssl_profile | re(".*") }}
			</group>
		</group>
	</group>
</template>